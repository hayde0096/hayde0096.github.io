<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>更衣人偶</title>
  <style>
    /* 基础样式 */
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f8f9fa;
      padding: 20px;
    }

    h1 {
      text-align: center;
      margin: 20px 0 20px;
      color: #2c3e50;
      font-size: 2em;
    }

    /* Issues提交提示 */
    .issues-notice {
      text-align: center;
      margin: 20px 0 40px;
      color: #666;
      font-size: 14px;
    }

    .issues-link {
      color: #2ea44f;
      text-decoration: none;
      border-bottom: 1px dotted #2ea44f;
      transition: all 0.2s;
    }

    .issues-link:hover {
      color: #22863a;
      border-bottom-style: solid;
    }

    /* 网格容器 */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 30px;
      max-width: 1400px;
      margin: 0 auto;
    }

    /* 卡片容器 */
    .image-item {
      background: white;
      border-radius: 12px;
      box-shadow: 0 3px 15px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      min-height: 400px;
    }

    /* 图片区域 */
    .image-container {
      flex: 1;
      padding: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-bottom: 1px solid #eee;
    }

    .image-container img {
      max-width: 100%;
      max-height: 300px;
      width: auto;
      height: auto;
      object-fit: contain;
    }

    /* 说明区域 */
    .description-box {
      height: 100px;
      padding: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .description-text {
      width: 100%;
      margin: 0;
      line-height: 1.4;
      color: #555;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      word-break: break-word;
      overflow: hidden;
    }

    .description-text:active {
      transform: scale(0.98);
    }

    @media (max-width: 600px) {
      .grid {
        grid-template-columns: 1fr;
      }
      
      .image-container img {
        max-height: 250px;
      }
      
      h1 {
        font-size: 1.8em;
      }
    }
  </style>
</head>
<body>
  <h1>更衣人偶</h1>
  
  <p class="issues-notice">
    想要提交的衣服可以提交在
    <a href="https://github.com/hayde0096/Kisegaeningyou/issues" 
       class="issues-link"
       target="_blank"
       rel="noopener noreferrer">
      Issues里
    </a>
  </p>

  <div id="image-grid" class="grid"></div>

  <script>
    // 配置信息
    const CONFIG = {
      REPO_OWNER: 'hayde0096',
      REPO_NAME: 'Kisegaeningyou',
      IMAGE_FOLDER: 'images'
    };

    // 文字缩放函数
    function autoShrinkText(element) {
      const container = element.parentElement;
      let fontSize = 16;
      element.style.fontSize = fontSize + 'px';
      
      while (element.scrollHeight > container.offsetHeight && fontSize > 5) {
        fontSize -= 0.5;
        element.style.fontSize = fontSize + 'px';
      }
    }

    // 创建图片卡片
    function createImageCard(imgUrl, description) {
      const card = document.createElement('div');
      card.className = 'image-item';
      
      // 图片容器
      const imgContainer = document.createElement('div');
      imgContainer.className = 'image-container';
      
      const img = new Image();
      img.src = imgUrl;
      img.onload = () => {
        img.style.opacity = 1;
        requestAnimationFrame(() => autoShrinkText(descText));
      };
      img.style.opacity = 0;
      img.style.transition = 'opacity 0.3s';
      
      // 说明容器
      const descBox = document.createElement('div');
      descBox.className = 'description-box';
      
      const descText = document.createElement('div');
      descText.className = 'description-text';
      descText.textContent = description || '暂无说明';
      
      // 点击复制功能
      descText.addEventListener('click', () => {
        navigator.clipboard.writeText(description)
          .then(() => {
            const originalText = descText.textContent;
            descText.textContent = '已复制 ✓';
            setTimeout(() => {
              descText.textContent = originalText;
              autoShrinkText(descText);
            }, 1000);
          });
      });

      // 组合元素
      imgContainer.appendChild(img);
      descBox.appendChild(descText);
      card.appendChild(imgContainer);
      card.appendChild(descBox);

      return card;
    }

    // 加载画廊数据
    async function loadGallery() {
      try {
        const filesRes = await fetch(
          `https://api.github.com/repos/${CONFIG.REPO_OWNER}/${CONFIG.REPO_NAME}/contents/${CONFIG.IMAGE_FOLDER}`
        );
        const allFiles = await filesRes.json();

        const imageFiles = allFiles.filter(file => 
          file.name.match(/\.(jpg|jpeg|png|gif)$/i) && 
          !file.name.endsWith('.desc.txt')
        );

        const grid = document.getElementById('image-grid');
        imageFiles.forEach(file => {
          const descFile = allFiles.find(f => f.name === `${file.name}.desc.txt`);
          const description = descFile ? atob(descFile.content) : '暂无说明';
          grid.appendChild(createImageCard(file.download_url, description));
        });

      } catch (error) {
        console.error('加载失败:', error);
        grid.innerHTML = `<p style="text-align:center;color:#dc3545;">数据加载失败，请刷新重试</p>`;
      }
    }

    // 窗口尺寸变化处理
    let resizeTimer;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(() => {
        document.querySelectorAll('.description-text').forEach(autoShrinkText);
      }, 200);
    });

    // 初始化加载
    window.addEventListener('DOMContentLoaded', loadGallery);
  </script>
</body>
</html>